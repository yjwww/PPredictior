
select  s_store_name
      ,sum(ss_net_profit)
 from store_sales
     ,date_dim
     ,store,
     (select ca_zip
     from (
      SELECT substr(ca_zip,1,5) ca_zip
      FROM customer_address
      WHERE substr(ca_zip,1,5) IN (
                          '89436','30868','65085','22977','83927','77557',
                          '58429','40697','80614','10502','32779',
                          '91137','61265','98294','17921','18427',
                          '21203','59362','87291','84093','21505',
                          '17184','10866','67898','25797','28055',
                          '18377','80332','74535','21757','29742',
                          '90885','29898','17819','40811','25990',
                          '47513','89531','91068','10391','18846',
                          '99223','82637','41368','83658','86199',
                          '81625','26696','89338','88425','32200',
                          '81427','19053','77471','36610','99823',
                          '43276','41249','48584','83550','82276',
                          '18842','78890','14090','38123','40936',
                          '34425','19850','43286','80072','79188',
                          '54191','11395','50497','84861','90733',
                          '21068','57666','37119','25004','57835',
                          '70067','62878','95806','19303','18840',
                          '19124','29785','16737','16022','49613',
                          '89977','68310','60069','98360','48649',
                          '39050','41793','25002','27413','39736',
                          '47208','16515','94808','57648','15009',
                          '80015','42961','63982','21744','71853',
                          '81087','67468','34175','64008','20261',
                          '11201','51799','48043','45645','61163',
                          '48375','36447','57042','21218','41100',
                          '89951','22745','35851','83326','61125',
                          '78298','80752','49858','52940','96976',
                          '63792','11376','53582','18717','90226',
                          '50530','94203','99447','27670','96577',
                          '57856','56372','16165','23427','54561',
                          '28806','44439','22926','30123','61451',
                          '92397','56979','92309','70873','13355',
                          '21801','46346','37562','56458','28286',
                          '47306','99555','69399','26234','47546',
                          '49661','88601','35943','39936','25632',
                          '24611','44166','56648','30379','59785',
                          '11110','14329','93815','52226','71381',
                          '13842','25612','63294','14664','21077',
                          '82626','18799','60915','81020','56447',
                          '76619','11433','13414','42548','92713',
                          '70467','30884','47484','16072','38936',
                          '13036','88376','45539','35901','19506',
                          '65690','73957','71850','49231','14276',
                          '20005','18384','76615','11635','38177',
                          '55607','41369','95447','58581','58149',
                          '91946','33790','76232','75692','95464',
                          '22246','51061','56692','53121','77209',
                          '15482','10688','14868','45907','73520',
                          '72666','25734','17959','24677','66446',
                          '94627','53535','15560','41967','69297',
                          '11929','59403','33283','52232','57350',
                          '43933','40921','36635','10827','71286',
                          '19736','80619','25251','95042','15526',
                          '36496','55854','49124','81980','35375',
                          '49157','63512','28944','14946','36503',
                          '54010','18767','23969','43905','66979',
                          '33113','21286','58471','59080','13395',
                          '79144','70373','67031','38360','26705',
                          '50906','52406','26066','73146','15884',
                          '31897','30045','61068','45550','92454',
                          '13376','14354','19770','22928','97790',
                          '50723','46081','30202','14410','20223',
                          '88500','67298','13261','14172','81410',
                          '93578','83583','46047','94167','82564',
                          '21156','15799','86709','37931','74703',
                          '83103','23054','70470','72008','49247',
                          '91911','69998','20961','70070','63197',
                          '54853','88191','91830','49521','19454',
                          '81450','89091','62378','25683','61869',
                          '51744','36580','85778','36871','48121',
                          '28810','83712','45486','67393','26935',
                          '42393','20132','55349','86057','21309',
                          '80218','10094','11357','48819','39734',
                          '40758','30432','21204','29467','30214',
                          '61024','55307','74621','11622','68908',
                          '33032','52868','99194','99900','84936',
                          '69036','99149','45013','32895','59004',
                          '32322','14933','32936','33562','72550',
                          '27385','58049','58200','16808','21360',
                          '32961','18586','79307','15492')
     intersect
      select ca_zip
      from (SELECT substr(ca_zip,1,5) ca_zip,count(*) cnt
            FROM customer_address, customer
            WHERE ca_address_sk = c_current_addr_sk and
                  c_preferred_cust_flag='Y'
            group by ca_zip
            having count(*) > 10)A1)A2) V1
 where ss_store_sk = s_store_sk
  and ss_sold_date_sk = d_date_sk
  and d_qoy = 1 and d_year = 2002
  and (substr(s_zip,1,2) = substr(V1.ca_zip,1,2))
 group by s_store_name
 order by s_store_name
 LIMIT 100;



select  s_store_name
      ,sum(ss_net_profit)
 from store_sales
     ,date_dim
     ,store,
     (select ca_zip
     from (
      SELECT substr(ca_zip,1,5) ca_zip
      FROM customer_address
      WHERE substr(ca_zip,1,5) IN (
                          '94211','79992','17147','73350','95552','95964',
                          '55561','83503','95291','81886','67803',
                          '14005','15352','35939','69788','69465',
                          '26210','94717','45717','20504','90727',
                          '73919','46409','31148','78856','51952',
                          '56658','59186','20236','39664','25479',
                          '78594','77585','48999','26659','40979',
                          '73998','58749','32169','88111','42206',
                          '17735','61235','40770','90216','73431',
                          '50635','94649','28503','62223','48465',
                          '98660','88750','62881','71150','74395',
                          '65573','54385','27053','75005','87100',
                          '46144','45752','48173','56128','44719',
                          '13165','47448','46589','98083','92734',
                          '59191','46743','32303','80247','49119',
                          '87663','28609','27220','75773','36942',
                          '88769','31029','11970','65289','54157',
                          '39828','16573','76507','11253','86979',
                          '93912','46157','41126','73708','43288',
                          '84025','93128','25843','83277','97822',
                          '12152','60970','20713','52014','13766',
                          '12054','67524','33300','81540','48540',
                          '34617','13904','20941','94950','41828',
                          '25750','42074','23769','80831','69469',
                          '94240','81975','91729','70390','66360',
                          '31770','51726','21985','90413','37770',
                          '89417','36432','11876','30715','40941',
                          '52138','25940','18308','41432','27325',
                          '32918','25864','68460','82185','33659',
                          '50905','45481','23148','84826','23289',
                          '64959','33374','75583','98214','40895',
                          '60252','68911','86559','47921','91792',
                          '21767','16714','36192','57781','23460',
                          '84556','95705','56373','34965','71858',
                          '67078','73474','83617','62740','31550',
                          '74359','90454','61357','79723','62749',
                          '69805','61783','48116','67366','32388',
                          '58504','99336','74644','85173','46041',
                          '28570','53752','44252','54305','67674',
                          '86596','97055','37196','54915','18790',
                          '32477','91830','24899','30659','69429',
                          '95386','41803','68146','90045','16572',
                          '65641','19959','43400','65967','11384',
                          '57058','73504','95723','95544','79738',
                          '52586','35436','39511','90114','67467',
                          '72042','93043','36460','68016','47066',
                          '36386','50886','59969','67561','96727',
                          '38794','40261','99622','68122','79229',
                          '61578','93750','79261','55336','34752',
                          '91425','74438','61232','39795','62410',
                          '39956','60094','57080','31815','35656',
                          '94130','65256','50034','96324','55887',
                          '69118','50706','19297','64728','14124',
                          '28972','68872','25699','61631','43656',
                          '84696','44847','55497','84007','53896',
                          '33193','63127','50002','92416','82870',
                          '72477','74061','97137','55994','26823',
                          '52147','78636','82211','29813','55691',
                          '54536','38580','60289','80266','81486',
                          '37739','58338','73713','16747','96061',
                          '29870','50644','69262','22387','58433',
                          '55314','60475','21391','14081','11028',
                          '69126','12943','68242','61807','55397',
                          '30981','49541','49422','60652','59552',
                          '44648','52906','74398','53160','27696',
                          '35803','19865','86380','13454','20648',
                          '70423','69100','45747','53046','71352',
                          '47386','23475','16902','18566','59929',
                          '28020','41953','59232','91434','57898',
                          '73452','76395','87527','46974','97877',
                          '20274','69056','60363','38187','10194',
                          '31880','18201','31666','38224','81782',
                          '62771','49892','17579','80473','80507',
                          '92101','93259','65722','30057','61776',
                          '38037','65719','66683','44040','48584',
                          '62751','90127','24971','44330','65895',
                          '29111','55957','53417','87081','11164',
                          '40693','48761','34746','11925','59373',
                          '61194','29863','53584','94406','86488',
                          '23160','66428','40619','14250')
     intersect
      select ca_zip
      from (SELECT substr(ca_zip,1,5) ca_zip,count(*) cnt
            FROM customer_address, customer
            WHERE ca_address_sk = c_current_addr_sk and
                  c_preferred_cust_flag='Y'
            group by ca_zip
            having count(*) > 10)A1)A2) V1
 where ss_store_sk = s_store_sk
  and ss_sold_date_sk = d_date_sk
  and d_qoy = 1 and d_year = 2001
  and (substr(s_zip,1,2) = substr(V1.ca_zip,1,2))
 group by s_store_name
 order by s_store_name
 LIMIT 100;



select  s_store_name
      ,sum(ss_net_profit)
 from store_sales
     ,date_dim
     ,store,
     (select ca_zip
     from (
      SELECT substr(ca_zip,1,5) ca_zip
      FROM customer_address
      WHERE substr(ca_zip,1,5) IN (
                          '14127','16281','67602','52068','35969','39265',
                          '66860','64000','19690','98788','42570',
                          '55696','21383','84706','92577','53412',
                          '49928','47291','50939','13438','96889',
                          '85931','11958','40521','45603','81074',
                          '73022','21993','55294','53532','29650',
                          '43909','40750','91836','19129','98235',
                          '14117','83897','41129','90470','54233',
                          '33371','76782','80988','18736','12796',
                          '65743','37875','87805','70965','89906',
                          '66274','77607','71034','26880','35907',
                          '11659','92672','64763','21800','54823',
                          '40135','24502','23210','78954','20029',
                          '41220','83925','53290','21289','91841',
                          '26480','13291','39470','30801','20990',
                          '21028','70826','44539','98802','24594',
                          '73040','19478','99068','96326','49003',
                          '12388','84252','60872','97534','15487',
                          '11822','76208','79879','96165','82622',
                          '49848','67789','59095','10168','10768',
                          '61873','28832','95625','18159','13110',
                          '33725','71809','85262','56794','97189',
                          '60015','23730','19352','18592','52742',
                          '60992','90058','96247','26194','81163',
                          '99315','60911','42024','68978','17126',
                          '96315','60009','61045','74176','49923',
                          '43154','73278','91351','91783','18315',
                          '78594','38729','90296','66254','36549',
                          '95236','54066','68047','15412','52680',
                          '52578','77635','34247','87907','85104',
                          '23694','85162','75441','95618','44769',
                          '52848','35561','32925','30474','51831',
                          '61214','47052','66017','55020','77191',
                          '98153','79679','40325','54426','69141',
                          '45470','95039','68573','63007','84855',
                          '96003','62053','79569','89520','25017',
                          '80600','22729','85191','55028','56860',
                          '34654','81599','90861','79794','33617',
                          '28949','83613','43632','27750','88477',
                          '82345','41429','34421','16194','88680',
                          '28458','32277','35875','18808','92860',
                          '80402','17337','89373','36275','10055',
                          '68265','38275','42703','44417','75376',
                          '38224','68258','15438','17711','80107',
                          '78902','43475','84777','48189','23536',
                          '19892','58195','21937','47584','39483',
                          '18410','20796','15480','38262','48413',
                          '74793','79412','49189','20702','82798',
                          '79587','14052','96657','20619','87735',
                          '69522','54317','18374','46199','61100',
                          '89621','67909','56796','82506','31138',
                          '40777','65470','12430','66114','66077',
                          '29742','69152','98701','63409','53253',
                          '58916','89141','29317','18870','43899',
                          '39456','88172','28417','86371','68947',
                          '22609','10405','95849','20635','47127',
                          '94183','61309','53230','53647','48785',
                          '53844','30419','62732','70672','77625',
                          '51869','41882','83428','94254','96920',
                          '77312','43272','80412','78571','97428',
                          '76243','62129','32188','26713','75372',
                          '71007','98565','44684','85562','72440',
                          '97111','79601','85277','14316','68745',
                          '18789','34237','52148','30722','66776',
                          '15963','41299','54406','45770','81138',
                          '86540','45966','17806','47554','73576',
                          '20054','83536','67827','30930','95375',
                          '69638','47187','98440','78784','53511',
                          '92217','67283','77760','41456','43869',
                          '36433','17847','79486','32997','57796',
                          '70976','82040','10162','58352','97153',
                          '14203','31744','37755','60324','56513',
                          '27706','39225','28100','43068','84379',
                          '32572','92862','53661','36898','90715',
                          '89526','14735','44819','73827','32724',
                          '11296','30590','99794','72800','63645',
                          '13864','40604','31601','82627','23771',
                          '94441','43049','76218','39966','17617',
                          '16156','11531','45899','50702','80431',
                          '90509','91213','41532','28400')
     intersect
      select ca_zip
      from (SELECT substr(ca_zip,1,5) ca_zip,count(*) cnt
            FROM customer_address, customer
            WHERE ca_address_sk = c_current_addr_sk and
                  c_preferred_cust_flag='Y'
            group by ca_zip
            having count(*) > 10)A1)A2) V1
 where ss_store_sk = s_store_sk
  and ss_sold_date_sk = d_date_sk
  and d_qoy = 2 and d_year = 2000
  and (substr(s_zip,1,2) = substr(V1.ca_zip,1,2))
 group by s_store_name
 order by s_store_name
 LIMIT 100;



select  s_store_name
      ,sum(ss_net_profit)
 from store_sales
     ,date_dim
     ,store,
     (select ca_zip
     from (
      SELECT substr(ca_zip,1,5) ca_zip
      FROM customer_address
      WHERE substr(ca_zip,1,5) IN (
                          '55641','65242','94981','85648','53844','23794',
                          '33983','92931','78867','79190','29659',
                          '75761','62501','24696','16323','78229',
                          '20494','81117','38308','14413','58789',
                          '76856','73053','43280','72630','54819',
                          '95775','29872','36804','53239','54458',
                          '62028','90180','14108','69114','55454',
                          '11589','60631','48981','16837','12224',
                          '51090','94489','66557','46498','64913',
                          '47072','78585','77082','52654','35707',
                          '10516','33902','38058','84075','53145',
                          '68438','86143','48504','59753','34783',
                          '46570','30400','41956','92510','23207',
                          '37391','44202','15055','62134','78747',
                          '95192','93113','39393','56491','36663',
                          '15745','48935','87514','14130','53028',
                          '85058','51404','21560','61323','63732',
                          '25000','11268','97871','88847','10033',
                          '13702','54187','12764','10709','27261',
                          '22804','46189','65710','29152','75512',
                          '16385','22886','41085','67860','77126',
                          '98809','19208','36505','92267','24561',
                          '65072','40376','63385','36721','93992',
                          '90061','19509','95786','92781','47192',
                          '20336','39502','18497','22333','51130',
                          '58549','37676','53935','11250','86101',
                          '75255','23319','97644','75559','24988',
                          '25494','63592','48094','73093','93713',
                          '96111','63196','62083','38653','80300',
                          '29552','61348','39149','64079','17410',
                          '30562','94600','17590','25709','32630',
                          '88376','35546','71201','71396','60863',
                          '13123','80102','66836','28348','88213',
                          '21320','21497','88026','90040','16658',
                          '18262','56769','90188','15294','82832',
                          '63462','39810','57277','31548','39735',
                          '12726','58767','85761','60026','31406',
                          '87330','94315','10847','91870','83245',
                          '31408','27512','22188','53209','96028',
                          '89114','29799','56039','45890','24019',
                          '76901','79489','78850','84594','58282',
                          '82343','67652','56167','93533','80566',
                          '30396','24271','27682','64999','42169',
                          '48284','31138','58472','14444','43290',
                          '90744','79873','74966','86439','23393',
                          '56033','86490','91190','34977','86423',
                          '58695','67413','98200','13128','76423',
                          '39759','54772','15304','74391','12231',
                          '36492','73585','22725','35991','86113',
                          '24222','92685','87944','49538','32483',
                          '76678','46054','45765','69080','22938',
                          '85544','54316','91288','67420','56626',
                          '19120','99359','36799','47693','97975',
                          '81806','85504','93348','39622','27380',
                          '31293','48992','87922','35831','38387',
                          '10457','31179','28490','44535','50489',
                          '80227','19469','34414','47837','22426',
                          '44124','43577','70673','44653','43912',
                          '57676','41767','75296','30566','70936',
                          '21708','92649','53379','20117','12205',
                          '75406','17743','73277','53251','88942',
                          '11760','69361','94797','46506','66512',
                          '56123','40509','18529','43928','74193',
                          '45318','17425','62189','27582','65607',
                          '20095','73801','20280','42893','28935',
                          '18593','70051','21145','55373','61012',
                          '33354','59945','23140','27794','62898',
                          '24469','68795','17703','84704','22551',
                          '79418','68762','26652','40624','24196',
                          '17729','64138','85308','10388','44628',
                          '55929','45084','27545','57780','41287',
                          '34908','40998','57319','38483','54690',
                          '97585','20415','72782','15240','61773',
                          '93181','93365','58975','15804','62386',
                          '15197','15434','21840','25334','63957',
                          '19664','83898','65551','21430','55932',
                          '49681','14532','15002','67425','11631',
                          '86009','95668','96675','60058','95662',
                          '20558','79167','11531','53082','75858',
                          '75616','19747','25506','34796')
     intersect
      select ca_zip
      from (SELECT substr(ca_zip,1,5) ca_zip,count(*) cnt
            FROM customer_address, customer
            WHERE ca_address_sk = c_current_addr_sk and
                  c_preferred_cust_flag='Y'
            group by ca_zip
            having count(*) > 10)A1)A2) V1
 where ss_store_sk = s_store_sk
  and ss_sold_date_sk = d_date_sk
  and d_qoy = 2 and d_year = 1999
  and (substr(s_zip,1,2) = substr(V1.ca_zip,1,2))
 group by s_store_name
 order by s_store_name
 LIMIT 100;



select  s_store_name
      ,sum(ss_net_profit)
 from store_sales
     ,date_dim
     ,store,
     (select ca_zip
     from (
      SELECT substr(ca_zip,1,5) ca_zip
      FROM customer_address
      WHERE substr(ca_zip,1,5) IN (
                          '32490','80133','59564','27233','31195','74873',
                          '49881','13892','86207','75229','65896',
                          '23072','22835','33052','72756','87398',
                          '45674','48994','39431','20846','66681',
                          '65151','94085','37562','17374','40551',
                          '46813','27027','65540','25438','68986',
                          '63254','57831','66390','85787','19152',
                          '74046','33775','52283','21619','36554',
                          '67172','54289','45204','80935','43344',
                          '64283','30424','34055','77848','35728',
                          '25600','97795','76654','19815','17081',
                          '21040','97661','41336','36523','37437',
                          '28645','35340','51449','93082','79408',
                          '35536','60725','19517','10373','64505',
                          '43894','89282','47657','49668','10230',
                          '45233','23784','53712','22443','75091',
                          '55094','19397','90929','17945','48661',
                          '64741','97815','19675','13063','80566',
                          '89785','15734','67718','23645','98852',
                          '81276','26639','35287','20813','71390',
                          '22970','82989','91358','35225','25402',
                          '91462','10654','13987','14795','64804',
                          '63781','49236','65485','17910','95923',
                          '39071','27201','68045','25588','17939',
                          '43782','74656','46429','32012','37539',
                          '85167','24503','50296','13486','84526',
                          '24023','22302','93280','68039','88738',
                          '41665','16136','40887','77281','88472',
                          '43699','49458','84968','27482','54271',
                          '61812','11596','10198','75859','59166',
                          '13824','54360','24990','40678','83853',
                          '18308','77081','64728','54301','39240',
                          '22549','88564','86354','19498','45730',
                          '60561','84545','28627','69495','22716',
                          '64853','76113','52205','56548','96326',
                          '68928','14901','96908','72550','40769',
                          '68253','85910','41588','57779','32502',
                          '73174','36235','19833','24542','37097',
                          '16758','32271','23538','62335','10019',
                          '97239','98318','15239','57446','42865',
                          '26330','83840','37114','11286','81632',
                          '12544','92809','43767','78584','83823',
                          '15036','63713','47975','63902','63292',
                          '25430','21182','59057','86422','49121',
                          '40027','81419','43925','20524','87983',
                          '21822','68191','76417','93014','63909',
                          '86640','30566','16176','50935','42919',
                          '51350','11631','85160','84840','64709',
                          '90765','97089','21806','16816','68294',
                          '39747','60921','35749','95100','51838',
                          '11721','33857','76555','58545','31814',
                          '87804','47999','69497','91498','17845',
                          '45225','17567','65864','50319','57774',
                          '77123','83613','50464','17503','40533',
                          '99960','94458','80012','49246','19702',
                          '67202','71266','43596','90358','54703',
                          '38674','16511','13010','84297','80138',
                          '50495','59286','61377','82813','84072',
                          '10775','92602','23383','78574','51189',
                          '99628','37223','40927','82218','67970',
                          '60622','75356','14696','86530','20282',
                          '73480','90684','82414','30411','79303',
                          '73396','42212','30379','11648','96036',
                          '33147','83350','10603','63986','53794',
                          '66233','12557','61902','58867','11765',
                          '49301','85512','64079','71983','55686',
                          '14321','31747','42910','51179','48814',
                          '98103','90450','44160','66586','82162',
                          '82087','28216','93605','64647','81083',
                          '30520','39257','77366','58370','95989',
                          '11154','83201','92181','50984','95103',
                          '67822','45454','71812','33151','14137',
                          '84208','71044','66111','66351','47974',
                          '78642','71186','39450','83373','80020',
                          '14803','54550','48784','44462','26683',
                          '84275','79531','88149','85090','92941',
                          '63518','40347','54000','55782','85163',
                          '12516','66948','36635','26691','28575',
                          '83438','69170','30158','90030','52806',
                          '51997','63427','10649','42552')
     intersect
      select ca_zip
      from (SELECT substr(ca_zip,1,5) ca_zip,count(*) cnt
            FROM customer_address, customer
            WHERE ca_address_sk = c_current_addr_sk and
                  c_preferred_cust_flag='Y'
            group by ca_zip
            having count(*) > 10)A1)A2) V1
 where ss_store_sk = s_store_sk
  and ss_sold_date_sk = d_date_sk
  and d_qoy = 2 and d_year = 1999
  and (substr(s_zip,1,2) = substr(V1.ca_zip,1,2))
 group by s_store_name
 order by s_store_name
 LIMIT 100;



select  s_store_name
      ,sum(ss_net_profit)
 from store_sales
     ,date_dim
     ,store,
     (select ca_zip
     from (
      SELECT substr(ca_zip,1,5) ca_zip
      FROM customer_address
      WHERE substr(ca_zip,1,5) IN (
                          '82912','16429','56372','94900','62843','98356',
                          '52140','91472','15284','30074','93060',
                          '87466','18023','12326','44629','72686',
                          '65854','17347','98884','94591','57710',
                          '74359','36064','15618','60047','83880',
                          '82758','48091','26772','32314','20650',
                          '23630','46805','13250','58970','87436',
                          '47667','37587','18693','59634','42981',
                          '84376','96058','21067','27798','14989',
                          '43259','24113','59807','61526','94954',
                          '78396','86864','76708','43124','17625',
                          '92671','46759','49146','66589','44376',
                          '79907','36181','96595','94595','30916',
                          '53727','73961','10742','36464','93749',
                          '74952','74791','59319','40362','88948',
                          '34103','44473','20557','39900','63196',
                          '23003','95474','84162','15186','16107',
                          '14725','24701','18388','89640','91829',
                          '83071','15027','61070','48078','10778',
                          '32885','55230','63841','68671','74466',
                          '33073','14604','66268','20819','96366',
                          '42451','27427','67755','61001','59395',
                          '25784','68106','36351','15724','31556',
                          '67270','83617','46640','30862','39269',
                          '44761','48968','77105','37871','20427',
                          '45744','65622','50828','91024','27516',
                          '40940','57469','24886','23441','84768',
                          '88601','15790','24862','38732','42379',
                          '15695','82454','79895','67554','10635',
                          '12145','40628','19386','29665','81476',
                          '60866','95975','30130','31535','37504',
                          '29499','25361','37631','54841','91571',
                          '25560','53494','81936','82095','21287',
                          '80936','51321','47181','24783','62263',
                          '20208','55880','46400','36050','59418',
                          '65971','61720','51511','76912','63529',
                          '94232','79488','62294','79472','21223',
                          '76802','34750','58792','78745','39187',
                          '20338','95230','63343','67667','63893',
                          '17279','15233','97222','90855','49321',
                          '25027','23130','40088','36066','59264',
                          '16862','55611','16079','15729','72696',
                          '77750','81369','19667','36334','99062',
                          '62644','30761','58447','20290','41781',
                          '39154','62125','31985','79985','41220',
                          '76500','24620','66099','21170','69063',
                          '75880','99776','10598','34081','35502',
                          '66895','35976','73763','87439','10843',
                          '39478','66252','33453','83542','12158',
                          '39735','11020','16094','64529','99318',
                          '27585','92693','60404','79506','82771',
                          '24642','53279','30009','44667','15445',
                          '79761','60182','27949','61864','17804',
                          '60952','72053','50534','57020','83098',
                          '71902','67843','36673','62298','45404',
                          '33046','85908','46923','50477','63165',
                          '84028','96235','12060','11599','83010',
                          '83255','97492','76842','33951','59429',
                          '89494','93219','15474','19054','32108',
                          '50555','37995','70185','19168','74455',
                          '46667','76431','94222','11697','38850',
                          '39162','53248','10579','74858','87860',
                          '48585','56050','25216','86584','54729',
                          '25416','88992','78126','64505','91520',
                          '10180','65006','74577','94312','53340',
                          '78341','84242','43333','37864','92080',
                          '68430','86211','94781','15901','27464',
                          '61649','84182','23261','28413','75217',
                          '44022','45930','70846','29107','91783',
                          '42754','84393','16174','32053','88758',
                          '40832','64059','22961','88379','66734',
                          '22304','18788','75385','37435','42427',
                          '10585','81738','18047','70152','48840',
                          '78295','84844','36923','45111','44709',
                          '57834','22783','18441','51641','56713',
                          '25706','13654','86335','58366','13245',
                          '56269','41052','75674','85272','82342',
                          '92694','42295','50147','44504','24644',
                          '32011','71053','30631','26418','46781',
                          '37768','10116','91468','95133')
     intersect
      select ca_zip
      from (SELECT substr(ca_zip,1,5) ca_zip,count(*) cnt
            FROM customer_address, customer
            WHERE ca_address_sk = c_current_addr_sk and
                  c_preferred_cust_flag='Y'
            group by ca_zip
            having count(*) > 10)A1)A2) V1
 where ss_store_sk = s_store_sk
  and ss_sold_date_sk = d_date_sk
  and d_qoy = 1 and d_year = 2000
  and (substr(s_zip,1,2) = substr(V1.ca_zip,1,2))
 group by s_store_name
 order by s_store_name
 LIMIT 100;



select  s_store_name
      ,sum(ss_net_profit)
 from store_sales
     ,date_dim
     ,store,
     (select ca_zip
     from (
      SELECT substr(ca_zip,1,5) ca_zip
      FROM customer_address
      WHERE substr(ca_zip,1,5) IN (
                          '15649','97176','11360','24494','95632','70829',
                          '13920','20200','71516','43566','64761',
                          '14371','53335','39963','35318','86348',
                          '69458','25752','38869','45374','84336',
                          '56953','46991','43630','13511','62831',
                          '18652','60853','61079','22429','70700',
                          '94674','36533','86246','45046','75688',
                          '87524','42949','15199','11458','62631',
                          '19163','25215','38302','77584','57121',
                          '77920','35077','20124','41697','42012',
                          '80974','34191','72215','40589','98087',
                          '60714','32206','45649','77868','91274',
                          '50134','10194','63169','48654','13691',
                          '56763','50550','11863','90278','74108',
                          '77386','65216','19678','14873','79800',
                          '70639','96537','95880','14642','78622',
                          '49704','87013','74044','65119','45127',
                          '41477','43403','80431','30916','45101',
                          '20266','35688','23097','40317','92254',
                          '46593','51307','67598','35427','21637',
                          '54133','95472','43230','60681','26367',
                          '96563','46070','49787','31523','38503',
                          '59099','63600','87308','26194','62098',
                          '49512','92542','45800','52600','94197',
                          '69741','21041','16703','62300','18307',
                          '27973','74633','88169','16625','37777',
                          '31628','54479','13057','22995','82447',
                          '60985','11425','87516','89804','70889',
                          '27175','94215','95471','94619','24322',
                          '47102','76579','11880','42729','17087',
                          '56261','80423','99752','50486','12143',
                          '11171','67932','79840','95301','92265',
                          '66338','91731','86557','50821','92884',
                          '38075','68951','35468','60592','72759',
                          '90361','84040','35063','47344','80501',
                          '98040','52919','85872','43919','51079',
                          '98329','29393','79122','72427','36702',
                          '24159','31016','98824','32545','85510',
                          '29492','96659','29763','31063','37533',
                          '63797','37369','66140','91245','58016',
                          '32788','49214','28211','89512','77950',
                          '28147','76974','38547','61447','22275',
                          '62125','32551','45994','14586','14100',
                          '42707','13565','29162','20957','34311',
                          '60299','41933','88106','17152','77062',
                          '71739','22227','96166','26383','89033',
                          '24221','14853','33951','47050','19103',
                          '69581','43820','18618','87654','58992',
                          '40373','91682','84541','74140','16555',
                          '20380','59341','19033','89178','53282',
                          '36260','62550','62025','94519','98393',
                          '43612','61451','46663','47520','37806',
                          '43418','70016','72504','88593','28437',
                          '73828','39659','15774','33551','26000',
                          '58506','17779','83210','58170','35925',
                          '64047','87926','52017','10473','47957',
                          '27050','90439','70545','81391','94703',
                          '32465','33114','83491','84583','82495',
                          '70071','88087','29557','89594','69039',
                          '77336','92848','92344','77266','32173',
                          '55542','95320','24332','13227','30839',
                          '46895','56687','10967','74162','11645',
                          '72462','87782','71803','21003','75424',
                          '33182','35552','46114','10639','76229',
                          '40375','43378','86016','27721','79311',
                          '98727','41952','39383','40967','35765',
                          '84366','31986','30304','42764','86670',
                          '43923','64577','14049','98434','13403',
                          '24805','70147','56387','78555','88271',
                          '95464','92040','82860','93850','45363',
                          '24257','67949','23664','12018','50458',
                          '81813','74815','77209','90540','15519',
                          '18714','38489','78960','78483','14855',
                          '25410','89318','34245','72407','37184',
                          '95451','60775','53607','25725','25574',
                          '79734','69066','82972','45655','64265',
                          '54047','85323','53842','71367','11320',
                          '73201','79231','93945','69444','96619',
                          '43755','33788','90027','37267','53417',
                          '71664','75380','31243','14280')
     intersect
      select ca_zip
      from (SELECT substr(ca_zip,1,5) ca_zip,count(*) cnt
            FROM customer_address, customer
            WHERE ca_address_sk = c_current_addr_sk and
                  c_preferred_cust_flag='Y'
            group by ca_zip
            having count(*) > 10)A1)A2) V1
 where ss_store_sk = s_store_sk
  and ss_sold_date_sk = d_date_sk
  and d_qoy = 1 and d_year = 2001
  and (substr(s_zip,1,2) = substr(V1.ca_zip,1,2))
 group by s_store_name
 order by s_store_name
 LIMIT 100;



select  s_store_name
      ,sum(ss_net_profit)
 from store_sales
     ,date_dim
     ,store,
     (select ca_zip
     from (
      SELECT substr(ca_zip,1,5) ca_zip
      FROM customer_address
      WHERE substr(ca_zip,1,5) IN (
                          '77465','97995','72537','21900','42499','52330',
                          '83610','73167','15686','85030','46804',
                          '88233','65158','12472','53269','80508',
                          '24560','52813','81622','16418','58991',
                          '50537','27152','54999','16785','82675',
                          '76889','81395','55130','38896','14208',
                          '98598','66935','52476','64233','90009',
                          '18332','49832','30797','45499','79663',
                          '43550','36279','99439','70375','30001',
                          '54009','69517','69740','59166','39009',
                          '96191','87649','39365','38379','45582',
                          '97450','45053','43288','46058','45113',
                          '47915','91376','89267','18138','72838',
                          '51397','38489','30740','73330','30795',
                          '16409','40256','53770','95419','51779',
                          '35561','83054','75117','24060','98388',
                          '42093','87121','82328','11033','57947',
                          '17917','74350','99900','61796','33493',
                          '99641','37504','66987','68014','65720',
                          '73105','26199','91335','17785','47313',
                          '62391','70292','15180','29492','65259',
                          '81625','69908','48239','70434','77483',
                          '24399','57375','25135','45747','11531',
                          '42789','78192','18654','86653','90239',
                          '77981','56007','26458','93115','75238',
                          '53312','12453','13404','35264','94144',
                          '90302','17422','18112','52238','89482',
                          '50734','44227','47560','28406','42543',
                          '41638','76496','87800','45526','41726',
                          '89427','11366','63993','58761','23561',
                          '82202','77510','90870','65019','99090',
                          '37461','21030','20086','36115','72203',
                          '46791','51062','22342','16184','24835',
                          '63840','33770','18818','32561','41117',
                          '16725','93309','57913','77395','41849',
                          '69152','75768','50195','92692','74443',
                          '14704','51107','43524','79407','71004',
                          '20227','40386','66426','74289','96908',
                          '49399','62680','82289','14104','82830',
                          '90876','34874','74969','77895','68353',
                          '83811','30134','63490','49806','73141',
                          '77733','46489','89660','10935','27003',
                          '79364','77982','12882','33558','23370',
                          '60564','14983','24939','33447','63759',
                          '16462','70273','15189','63406','42185',
                          '32505','63108','48305','83529','31536',
                          '76094','19184','83590','33560','93962',
                          '32510','98269','12912','80541','99138',
                          '51278','27848','90747','14890','91593',
                          '74080','54731','15976','12289','45422',
                          '55999','22900','17535','28293','48231',
                          '50488','80367','24273','67884','69225',
                          '80496','22359','47461','12915','45218',
                          '91034','84049','11455','15766','97588',
                          '24927','49694','31029','60639','32025',
                          '30265','71497','60326','44707','90330',
                          '39539','84911','73782','43783','65204',
                          '42466','37845','70726','36584','98658',
                          '23536','31272','76587','36960','98215',
                          '66851','51442','13313','57121','90226',
                          '98625','91584','55432','51860','97515',
                          '50220','91855','70844','81729','94215',
                          '27426','77085','41373','91641','91399',
                          '41262','87202','32971','28564','80190',
                          '32532','78675','26993','72447','52550',
                          '93469','94488','34282','66268','69331',
                          '25830','51007','91581','29966','83846',
                          '70752','79546','42087','82460','52786',
                          '66746','20182','17010','55861','51876',
                          '23805','40636','51267','37212','81557',
                          '27311','33246','38973','80038','12735',
                          '20676','23267','36439','71060','74201',
                          '18946','37237','48913','79605','33851',
                          '99932','49974','34725','13531','13242',
                          '63267','51214','14542','57525','50551',
                          '34631','32594','27557','14478','11548',
                          '66318','88581','38329','86517','99349',
                          '29495','94651','51906','48404','92612',
                          '61791','81485','86188','45253','88898',
                          '56706','45106','88875','78579')
     intersect
      select ca_zip
      from (SELECT substr(ca_zip,1,5) ca_zip,count(*) cnt
            FROM customer_address, customer
            WHERE ca_address_sk = c_current_addr_sk and
                  c_preferred_cust_flag='Y'
            group by ca_zip
            having count(*) > 10)A1)A2) V1
 where ss_store_sk = s_store_sk
  and ss_sold_date_sk = d_date_sk
  and d_qoy = 1 and d_year = 2000
  and (substr(s_zip,1,2) = substr(V1.ca_zip,1,2))
 group by s_store_name
 order by s_store_name
 LIMIT 100;



select  s_store_name
      ,sum(ss_net_profit)
 from store_sales
     ,date_dim
     ,store,
     (select ca_zip
     from (
      SELECT substr(ca_zip,1,5) ca_zip
      FROM customer_address
      WHERE substr(ca_zip,1,5) IN (
                          '77661','12172','48633','30522','77516','47593',
                          '42736','13431','60328','51004','58830',
                          '73231','71595','92456','44605','64787',
                          '50000','56786','59080','41562','41317',
                          '26178','77460','24505','44648','61157',
                          '13884','60939','92187','63308','18653',
                          '73267','76681','88231','91314','74382',
                          '75606','29255','83554','46014','65895',
                          '50527','19535','23406','50114','61466',
                          '71101','73924','91310','84787','45297',
                          '25515','68057','15152','86347','88689',
                          '86473','50762','73297','21927','92168',
                          '76750','42285','63085','87127','94952',
                          '35208','42352','86699','98853','55431',
                          '94022','59292','39267','10988','14027',
                          '88033','31548','64656','64512','18602',
                          '10987','11720','55625','19973','52110',
                          '62644','78897','99512','66942','53325',
                          '70523','75029','18193','47516','96854',
                          '81962','81713','91216','29121','80380',
                          '40713','15209','50902','22005','14580',
                          '29238','73890','30936','29189','97505',
                          '24818','64230','91895','38383','19044',
                          '38267','16085','52139','48122','95943',
                          '13984','64043','14978','49016','97128',
                          '93772','14165','91610','38123','34007',
                          '69476','76457','72132','21390','47749',
                          '37146','84573','63802','12827','60529',
                          '76981','57559','23016','93676','56982',
                          '86490','36898','92619','33273','51562',
                          '35923','10366','78029','60253','22718',
                          '85212','15723','61055','79099','22567',
                          '45156','61470','66324','29587','34043',
                          '34227','53678','21955','39619','75643',
                          '51511','40586','90275','44572','42544',
                          '43791','13860','44862','39928','87728',
                          '94568','34480','70964','98578','44326',
                          '45839','66931','42597','98820','52995',
                          '72960','70171','79195','16334','65832',
                          '58766','29846','57002','28957','88020',
                          '43307','50922','38774','15259','41193',
                          '61960','62508','35487','26330','45824',
                          '92253','23296','68030','31515','19769',
                          '40502','71085','54574','36213','56352',
                          '55190','82114','73270','48477','41413',
                          '30645','42093','78603','91322','51853',
                          '47847','49129','26639','45520','52677',
                          '85032','79762','83843','37492','88618',
                          '21246','61452','27527','35458','95902',
                          '31273','62479','46299','80444','99543',
                          '89604','86602','89989','97557','95208',
                          '90174','47678','29040','40582','96188',
                          '87296','81077','14110','59332','79030',
                          '36974','87957','31422','74945','73824',
                          '77574','34618','80026','75507','70507',
                          '48515','95175','76862','42324','92637',
                          '88631','87734','88877','49347','86828',
                          '95755','77909','41381','35294','20519',
                          '64833','22968','87085','53177','89833',
                          '59398','17607','20589','38856','45237',
                          '61536','34481','24375','96936','46029',
                          '57685','35229','39688','50903','41271',
                          '89837','76868','97935','65752','46213',
                          '25002','88792','76658','84635','23513',
                          '93300','49474','62205','45199','38889',
                          '63170','62794','92784','55129','89426',
                          '18462','89987','14644','98666','97414',
                          '65282','25277','34067','12478','78150',
                          '46564','60063','23990','74238','16654',
                          '91228','28010','67934','82207','79409',
                          '52936','54861','80268','74848','16098',
                          '87271','71472','29436','70919','99727',
                          '50661','25684','60808','36672','78116',
                          '75339','12832','86047','68857','14486',
                          '41324','54118','84326','35624','19798',
                          '56221','75850','72679','66290','55722',
                          '48721','91406','39882','46691','10489',
                          '53674','62555','64484','70113','67138',
                          '87273','10558','79037','20966','84340',
                          '52873','91404','53064','57042')
     intersect
      select ca_zip
      from (SELECT substr(ca_zip,1,5) ca_zip,count(*) cnt
            FROM customer_address, customer
            WHERE ca_address_sk = c_current_addr_sk and
                  c_preferred_cust_flag='Y'
            group by ca_zip
            having count(*) > 10)A1)A2) V1
 where ss_store_sk = s_store_sk
  and ss_sold_date_sk = d_date_sk
  and d_qoy = 2 and d_year = 2000
  and (substr(s_zip,1,2) = substr(V1.ca_zip,1,2))
 group by s_store_name
 order by s_store_name
 LIMIT 100;



select  s_store_name
      ,sum(ss_net_profit)
 from store_sales
     ,date_dim
     ,store,
     (select ca_zip
     from (
      SELECT substr(ca_zip,1,5) ca_zip
      FROM customer_address
      WHERE substr(ca_zip,1,5) IN (
                          '41997','76861','10255','66115','77066','91619',
                          '14077','13159','82549','46801','96716',
                          '57292','61178','29690','26494','37527',
                          '79770','52650','78897','67576','53435',
                          '94509','36254','60024','61274','93006',
                          '31463','22110','38721','54522','13110',
                          '43696','28969','34480','37762','55369',
                          '74314','68127','61755','61095','50007',
                          '92328','78545','47422','19765','15787',
                          '53332','93155','36803','16970','34637',
                          '67307','96667','56956','12873','89780',
                          '41908','83971','94066','22075','14188',
                          '93752','47603','83781','62371','15023',
                          '51729','12079','18545','60789','92723',
                          '49736','62164','86402','93795','26879',
                          '94367','14752','52151','64691','77944',
                          '10512','25102','98934','68220','90199',
                          '24834','73571','35390','28982','59172',
                          '18786','64902','93527','66696','48527',
                          '15169','36763','31958','31594','31037',
                          '56512','31876','43661','81674','78032',
                          '34495','46481','61507','29227','61656',
                          '24684','62042','63354','92507','28466',
                          '76876','88243','55038','64521','19255',
                          '94230','96324','91542','73359','28381',
                          '21334','63681','71059','97357','11902',
                          '33858','66551','82585','34875','41250',
                          '37459','77616','64198','49467','21497',
                          '24600','76491','53249','10716','38882',
                          '17153','64275','82415','68643','76783',
                          '98797','67960','96190','81244','49322',
                          '34644','16195','90894','26338','86453',
                          '65413','87615','61242','41677','69210',
                          '58523','87075','83263','24569','89961',
                          '14239','23541','11660','55686','47923',
                          '12882','58013','59363','91239','69417',
                          '38453','84695','64964','83935','29356',
                          '57730','71432','42441','73321','32114',
                          '38975','29657','95870','17507','58366',
                          '80756','49043','15888','23324','72549',
                          '45268','35241','25573','87606','44619',
                          '24782','23652','55133','69858','57798',
                          '37273','43674','70148','23156','63530',
                          '95030','87645','28625','94090','97622',
                          '68017','78391','71346','12826','94847',
                          '31654','57726','39611','79581','42532',
                          '31783','84797','70737','53694','90114',
                          '80196','16553','40876','13832','55940',
                          '26068','46817','73501','83070','78022',
                          '83862','79852','83649','35914','18178',
                          '77966','47754','91259','98430','68527',
                          '61801','63326','19878','80959','42018',
                          '32867','44242','35775','22184','10574',
                          '41621','73769','19260','42569','78445',
                          '90458','58375','85276','17241','71947',
                          '44702','18562','93116','12099','98009',
                          '64705','17221','31855','43297','85718',
                          '47741','55653','48755','11614','18707',
                          '90227','42936','74787','52622','20702',
                          '91843','69537','51456','33361','70008',
                          '64435','40845','32016','72230','23765',
                          '20879','53918','11917','91348','58682',
                          '97674','43575','56888','91770','64957',
                          '23640','17336','30170','14464','74126',
                          '38474','36868','40348','89543','21419',
                          '30472','53905','78767','16293','50845',
                          '45987','95054','52680','60265','79551',
                          '89750','62789','94555','13380','98048',
                          '89059','47757','70812','15357','64880',
                          '13541','43887','49271','34021','17223',
                          '63152','86071','51408','33045','93350',
                          '41600','88946','52126','66012','81020',
                          '31549','30188','31861','14616','37126',
                          '53898','29348','38643','97816','17522',
                          '53494','55807','32509','47822','89966',
                          '69677','39965','54885','46084','97211',
                          '57160','53914','42915','91089','15110',
                          '10040','92648','22296','34054','16844',
                          '83423','89823','83143','69868','70411',
                          '60169','95884','66336','10674')
     intersect
      select ca_zip
      from (SELECT substr(ca_zip,1,5) ca_zip,count(*) cnt
            FROM customer_address, customer
            WHERE ca_address_sk = c_current_addr_sk and
                  c_preferred_cust_flag='Y'
            group by ca_zip
            having count(*) > 10)A1)A2) V1
 where ss_store_sk = s_store_sk
  and ss_sold_date_sk = d_date_sk
  and d_qoy = 1 and d_year = 2002
  and (substr(s_zip,1,2) = substr(V1.ca_zip,1,2))
 group by s_store_name
 order by s_store_name
 LIMIT 100;



select  s_store_name
      ,sum(ss_net_profit)
 from store_sales
     ,date_dim
     ,store,
     (select ca_zip
     from (
      SELECT substr(ca_zip,1,5) ca_zip
      FROM customer_address
      WHERE substr(ca_zip,1,5) IN (
                          '11967','50753','31853','43636','46408','66484',
                          '37430','48281','62224','34846','48043',
                          '26919','12065','55469','11906','18006',
                          '92437','24612','30362','32936','95274',
                          '50736','34495','80319','44752','75561',
                          '63231','49156','38515','63908','78615',
                          '33750','60063','97996','90127','17852',
                          '57464','98312','74373','68290','66917',
                          '72624','76548','82154','85079','46516',
                          '47522','26999','53513','35459','84405',
                          '63167','18143','39322','76550','46069',
                          '33408','91019','23449','12860','86536',
                          '81077','42627','99133','85432','91674',
                          '77451','88747','50803','59869','31522',
                          '62679','75115','31269','83525','86629',
                          '31037','42665','53764','18195','49313',
                          '28547','21511','82761','50777','56598',
                          '12359','55580','67592','30610','13470',
                          '63045','13405','37336','54820','64372',
                          '73890','38878','28618','97292','46205',
                          '65805','10979','16303','83872','28594',
                          '26145','19274','29759','21339','93794',
                          '45477','28775','59342','49865','20278',
                          '35228','89935','92889','22772','77651',
                          '13202','87176','24350','39623','80624',
                          '70845','47861','86450','28792','96217',
                          '98717','65068','86257','25779','82124',
                          '82906','74677','70070','48100','67797',
                          '98511','94635','90134','31208','18540',
                          '97815','15765','26521','25293','92693',
                          '53786','39150','76795','20618','16735',
                          '19622','49120','61595','58494','35023',
                          '33998','32924','89401','79885','47244',
                          '22429','67681','86625','95482','59767',
                          '68594','57018','18199','31251','63871',
                          '59260','55432','95019','22803','88253',
                          '80770','43946','95018','88406','57026',
                          '61070','26416','37251','64752','41981',
                          '12991','26704','24657','71934','48130',
                          '23468','43321','23679','98355','59008',
                          '43078','98813','61896','30615','60213',
                          '53040','23572','20774','95908','62954',
                          '31539','77179','24543','14686','98543',
                          '14147','70075','49413','78151','81618',
                          '30697','84301','58150','64387','19294',
                          '22082','55714','45284','61193','35152',
                          '95577','87688','69811','83068','36905',
                          '86380','51003','72693','60678','23032',
                          '22996','59053','60228','34079','92347',
                          '12358','89458','22241','51682','55456',
                          '67687','96315','10740','45474','14001',
                          '26668','84537','46376','89269','11256',
                          '51663','38443','15106','68930','68798',
                          '86947','59785','19503','78618','88503',
                          '75687','74806','95521','27429','52553',
                          '41829','40369','51321','47795','24521',
                          '22271','21270','79750','31963','94106',
                          '69201','13197','54477','80427','68168',
                          '94117','81367','45893','45201','31844',
                          '15487','79672','73290','53189','67829',
                          '86025','41951','69233','23962','19780',
                          '85914','63408','98886','20501','94856',
                          '88690','12783','48347','77381','79848',
                          '55102','11536','86443','83354','21253',
                          '50186','99680','11044','42022','24980',
                          '88030','46443','12268','46064','69805',
                          '95238','13917','77547','50608','95828',
                          '58044','83527','43111','78552','62875',
                          '11993','10213','24101','97340','53937',
                          '82480','99190','71296','74625','82818',
                          '39527','30470','85289','93308','12061',
                          '91041','48585','13122','42083','86399',
                          '92650','21264','78111','96048','93186',
                          '39936','53819','84188','28654','68791',
                          '71056','33167','23810','34490','33568',
                          '79556','56181','55091','23057','11103',
                          '18202','30207','52126','60336','46879',
                          '94484','44334','70449','30552','15453',
                          '89228','10797','32604','15528','69884',
                          '52695','37452','25699','38813')
     intersect
      select ca_zip
      from (SELECT substr(ca_zip,1,5) ca_zip,count(*) cnt
            FROM customer_address, customer
            WHERE ca_address_sk = c_current_addr_sk and
                  c_preferred_cust_flag='Y'
            group by ca_zip
            having count(*) > 10)A1)A2) V1
 where ss_store_sk = s_store_sk
  and ss_sold_date_sk = d_date_sk
  and d_qoy = 2 and d_year = 2000
  and (substr(s_zip,1,2) = substr(V1.ca_zip,1,2))
 group by s_store_name
 order by s_store_name
 LIMIT 100;



select  s_store_name
      ,sum(ss_net_profit)
 from store_sales
     ,date_dim
     ,store,
     (select ca_zip
     from (
      SELECT substr(ca_zip,1,5) ca_zip
      FROM customer_address
      WHERE substr(ca_zip,1,5) IN (
                          '84717','44016','89941','19345','50950','23366',
                          '27912','51465','85316','49103','96747',
                          '84974','16556','50905','20745','11569',
                          '96269','38605','74470','90448','71526',
                          '27230','72559','55999','14133','74834',
                          '50458','85987','51315','89294','80972',
                          '98692','85529','24436','82687','99776',
                          '20136','60524','91513','36905','44420',
                          '33221','60241','37420','85842','99686',
                          '10436','90806','52824','86165','68464',
                          '37778','10811','73076','28072','30446',
                          '34795','31261','77604','39177','90709',
                          '24540','49264','14394','44109','64591',
                          '19379','42503','41422','64446','38817',
                          '47813','47710','29639','96043','33343',
                          '55655','93618','55468','83376','80771',
                          '76199','19272','49440','86317','36933',
                          '33032','35004','31183','89522','55686',
                          '39986','51428','71694','10544','70263',
                          '88043','71175','52707','67783','98217',
                          '20063','86234','65345','57433','76920',
                          '22160','48674','20984','37639','95164',
                          '69061','59741','62824','77048','15503',
                          '80361','15755','74524','72368','49281',
                          '18074','36842','42578','69847','61498',
                          '53698','94654','54068','46818','96576',
                          '93800','55941','32876','82259','26864',
                          '91175','43936','18267','85673','70004',
                          '14208','19256','10186','81232','92543',
                          '52588','75645','20130','63923','37242',
                          '68006','31552','97218','50404','36428',
                          '73858','70140','70604','59408','54087',
                          '70306','70289','93670','67633','24568',
                          '21490','53407','56619','98292','82382',
                          '57020','93660','36060','37272','38036',
                          '92854','98343','79623','71882','91037',
                          '76083','23167','44567','61128','45277',
                          '16480','33502','92585','11917','32707',
                          '13647','48386','67866','66086','93475',
                          '49168','64886','99738','38097','60955',
                          '66468','56839','46194','64099','52918',
                          '27503','14114','46901','24265','85989',
                          '50508','78776','30103','48320','33980',
                          '97145','45361','93138','79029','49099',
                          '62753','93548','71420','89769','43153',
                          '37029','55883','74291','75605','55029',
                          '19191','62589','92732','67475','75033',
                          '17498','56659','10237','31913','58698',
                          '31742','64885','82168','25520','24445',
                          '17666','33228','96281','49560','89346',
                          '85143','24394','96410','83027','35551',
                          '56980','34167','79674','98913','69509',
                          '50487','20782','46770','44114','15687',
                          '24816','19688','58911','97303','77916',
                          '60214','45575','54835','86550','38685',
                          '76604','80488','71125','57340','57370',
                          '61984','49608','83743','92222','64102',
                          '33151','45816','12377','40532','64558',
                          '58298','38225','59705','96967','37508',
                          '76409','27474','21670','75692','66173',
                          '65940','67745','15429','16872','95635',
                          '12027','73213','28131','29402','32510',
                          '38728','45533','67499','19509','89853',
                          '97845','86901','62343','77514','82010',
                          '71770','50172','53558','21381','62780',
                          '44919','85259','55133','10408','97966',
                          '82323','31487','58351','35745','81939',
                          '43467','88209','58209','39666','51587',
                          '81444','92186','29895','84733','11032',
                          '27646','49428','97399','95010','35875',
                          '67718','61104','56352','27420','67784',
                          '52961','79375','94186','67544','72452',
                          '12230','88894','60555','62270','49885',
                          '62928','13701','24463','41109','49927',
                          '21069','12311','90652','82610','35469',
                          '33777','22535','92000','58078','53037',
                          '17990','14116','64994','73778','27071',
                          '61511','19771','67762','43211','83948',
                          '84412','51237','64197','27386','70114',
                          '26287','39943','13639','63295')
     intersect
      select ca_zip
      from (SELECT substr(ca_zip,1,5) ca_zip,count(*) cnt
            FROM customer_address, customer
            WHERE ca_address_sk = c_current_addr_sk and
                  c_preferred_cust_flag='Y'
            group by ca_zip
            having count(*) > 10)A1)A2) V1
 where ss_store_sk = s_store_sk
  and ss_sold_date_sk = d_date_sk
  and d_qoy = 1 and d_year = 2001
  and (substr(s_zip,1,2) = substr(V1.ca_zip,1,2))
 group by s_store_name
 order by s_store_name
 LIMIT 100;



select  s_store_name
      ,sum(ss_net_profit)
 from store_sales
     ,date_dim
     ,store,
     (select ca_zip
     from (
      SELECT substr(ca_zip,1,5) ca_zip
      FROM customer_address
      WHERE substr(ca_zip,1,5) IN (
                          '88626','30461','41106','52673','93506','82111',
                          '44875','11602','20969','53461','10014',
                          '87670','28707','50003','11849','36202',
                          '72966','16094','70206','36443','66567',
                          '78273','27017','77005','14718','58217',
                          '54449','12378','51254','73026','22934',
                          '56166','94975','47961','95629','33445',
                          '34861','81075','33057','91120','35810',
                          '22897','91983','14764','83685','61105',
                          '77754','82939','78635','11422','37329',
                          '66056','90845','55728','58603','59606',
                          '72975','55051','23679','22462','98486',
                          '41149','69291','63441','20054','55469',
                          '19664','16712','96631','38270','86912',
                          '70424','26201','44690','79681','52676',
                          '97914','27524','18782','12550','72279',
                          '18588','44266','71849','71074','87964',
                          '40648','97411','54033','81279','40662',
                          '51929','58760','40417','93485','83926',
                          '20224','81909','55767','53576','74071',
                          '68413','37878','80312','34299','39760',
                          '22812','96166','35706','82071','81272',
                          '82290','34852','62128','34833','82441',
                          '79360','28984','23811','12029','46219',
                          '69798','13252','65630','23677','67933',
                          '21969','79540','35109','96877','51412',
                          '56375','65816','85861','51421','45234',
                          '10961','36743','83995','44262','43257',
                          '64142','41688','94716','30318','45545',
                          '60877','48520','48305','61665','34038',
                          '73621','33462','38856','65744','77493',
                          '96823','69548','27840','48349','83206',
                          '98977','51886','86611','41010','53550',
                          '36871','59959','17919','54849','41160',
                          '64589','21429','80105','73219','52783',
                          '10731','24711','65884','82650','87831',
                          '18551','43286','30493','32392','92426',
                          '33783','21347','93036','47251','14851',
                          '44110','92856','10814','79231','32274',
                          '64123','26823','89693','91235','14275',
                          '49713','73135','64737','67258','13586',
                          '38535','42836','13282','85016','56710',
                          '58770','85638','31201','42139','27191',
                          '61799','92299','15460','63761','30068',
                          '17897','11127','58543','33364','12948',
                          '69694','67070','67151','81799','19127',
                          '96394','62511','86307','59348','63244',
                          '29520','17261','12888','52171','50174',
                          '59542','85430','60998','54467','52224',
                          '45660','39648','71432','84951','18335',
                          '17006','63229','20143','90611','31150',
                          '32745','58264','23292','77637','57800',
                          '36596','34792','53486','36715','91674',
                          '32971','18376','75994','70235','32270',
                          '54654','54846','35743','68459','65713',
                          '34123','54913','63647','77090','18010',
                          '61312','56374','60993','61860','35593',
                          '93084','46312','95197','88185','56778',
                          '46662','91245','75671','74961','40502',
                          '36197','65492','65890','34426','48264',
                          '70160','92880','17493','51787','73249',
                          '70913','44035','91323','55968','93650',
                          '78376','50476','21151','79123','47179',
                          '19819','38379','15614','23561','51368',
                          '63231','74159','57244','78724','92400',
                          '42004','16856','54387','20855','50778',
                          '25406','46728','38162','53160','74284',
                          '72210','85838','63846','96818','27909',
                          '20060','35549','73372','78009','33407',
                          '75698','37278','60433','39050','24688',
                          '20007','83871','15635','47064','45561',
                          '71265','36073','10666','31738','32184',
                          '37262','48921','60029','37682','96594',
                          '42083','19118','73970','67756','94548',
                          '27908','86941','91993','30654','14377',
                          '68054','16210','48984','56589','34005',
                          '57942','55280','73882','51317','22154',
                          '81342','22523','86505','30602','36793',
                          '64460','46725','60034','93142','19971',
                          '92390','67266','72126','71076')
     intersect
      select ca_zip
      from (SELECT substr(ca_zip,1,5) ca_zip,count(*) cnt
            FROM customer_address, customer
            WHERE ca_address_sk = c_current_addr_sk and
                  c_preferred_cust_flag='Y'
            group by ca_zip
            having count(*) > 10)A1)A2) V1
 where ss_store_sk = s_store_sk
  and ss_sold_date_sk = d_date_sk
  and d_qoy = 2 and d_year = 1998
  and (substr(s_zip,1,2) = substr(V1.ca_zip,1,2))
 group by s_store_name
 order by s_store_name
 LIMIT 100;



select  s_store_name
      ,sum(ss_net_profit)
 from store_sales
     ,date_dim
     ,store,
     (select ca_zip
     from (
      SELECT substr(ca_zip,1,5) ca_zip
      FROM customer_address
      WHERE substr(ca_zip,1,5) IN (
                          '28474','21420','57983','23572','88082','88822',
                          '78307','25307','43781','83182','98538',
                          '39203','76914','11261','21320','46659',
                          '93180','90483','46096','71331','59145',
                          '43944','24885','63103','94014','32828',
                          '15403','76200','21230','98193','35207',
                          '25695','49462','58364','96771','13387',
                          '72214','83162','79324','58425','65489',
                          '87425','28603','46049','23709','99343',
                          '67855','40403','37019','77001','50438',
                          '25495','45593','71513','23546','66853',
                          '20508','16638','28965','73149','59455',
                          '39759','70011','80144','25947','89004',
                          '24235','37699','67885','16986','56733',
                          '84710','91674','81162','70726','53265',
                          '86649','79775','41002','36455','38159',
                          '30259','78570','11806','86756','34055',
                          '93705','74842','56741','34182','60186',
                          '74687','44488','95522','15320','62378',
                          '45348','75561','26353','37086','11579',
                          '89358','26106','33167','43021','61041',
                          '64480','51660','78496','59615','27286',
                          '46926','21430','12929','46908','31997',
                          '73745','92144','58944','72130','21688',
                          '85866','14928','94747','39956','77904',
                          '60452','76232','97605','55755','53894',
                          '64475','46697','22312','18830','35173',
                          '12031','53502','66777','28628','62806',
                          '17339','86453','27454','97770','25127',
                          '82151','12964','63563','29122','13399',
                          '34816','47158','69065','81911','60170',
                          '74519','79593','60304','24127','45596',
                          '56373','77110','87758','66907','72912',
                          '92844','39034','84967','23236','34625',
                          '14568','84113','69298','68553','27593',
                          '74200','32292','41479','37043','52170',
                          '87177','92683','11590','73517','78299',
                          '57624','66794','86266','48194','39967',
                          '19016','16338','30518','98219','55209',
                          '88247','33484','84251','38246','13719',
                          '30819','26414','33321','25090','37358',
                          '17167','55637','30778','91828','74300',
                          '62526','40251','54896','59808','56748',
                          '54337','99461','76957','95430','46032',
                          '21608','88380','60080','77635','73202',
                          '64799','12028','43905','11928','87689',
                          '92894','52568','54266','46346','65192',
                          '67303','70470','76603','31672','44482',
                          '71996','53152','91413','17027','45641',
                          '63116','53602','80492','22678','89107',
                          '94258','17209','89965','74397','11771',
                          '98039','27125','35903','17393','20985',
                          '31215','85492','22046','18254','18946',
                          '82853','13079','48665','93785','64564',
                          '84749','28687','61413','89846','38002',
                          '68131','56112','74409','74656','39252',
                          '79121','42517','26175','54379','96262',
                          '99363','56729','50166','14186','55442',
                          '18289','13950','28054','25180','56907',
                          '59872','33444','21631','63376','28046',
                          '18642','52452','88664','65102','14654',
                          '72982','99462','38203','67352','99110',
                          '71731','71650','92975','68002','32272',
                          '66868','39176','21228','46921','12529',
                          '37933','12331','73818','92202','44174',
                          '59609','63929','14914','64347','51376',
                          '77561','14192','17608','74458','42033',
                          '57643','35600','32416','50982','15056',
                          '79496','10647','89798','61052','41839',
                          '12306','70453','54914','54785','81923',
                          '79031','52059','20863','28684','44963',
                          '34333','94228','70477','74417','16598',
                          '32586','62772','75899','11242','40517',
                          '45535','89745','26277','75412','38518',
                          '66677','97627','25513','96686','54291',
                          '56966','70307','35216','51572','39157',
                          '52553','70651','66932','20550','39372',
                          '76643','16854','81044','57407','96946',
                          '16523','53380','76853','45804','59693',
                          '27287','74543','27198','72778')
     intersect
      select ca_zip
      from (SELECT substr(ca_zip,1,5) ca_zip,count(*) cnt
            FROM customer_address, customer
            WHERE ca_address_sk = c_current_addr_sk and
                  c_preferred_cust_flag='Y'
            group by ca_zip
            having count(*) > 10)A1)A2) V1
 where ss_store_sk = s_store_sk
  and ss_sold_date_sk = d_date_sk
  and d_qoy = 2 and d_year = 1998
  and (substr(s_zip,1,2) = substr(V1.ca_zip,1,2))
 group by s_store_name
 order by s_store_name
 LIMIT 100;



select  s_store_name
      ,sum(ss_net_profit)
 from store_sales
     ,date_dim
     ,store,
     (select ca_zip
     from (
      SELECT substr(ca_zip,1,5) ca_zip
      FROM customer_address
      WHERE substr(ca_zip,1,5) IN (
                          '74285','86603','97367','66387','35562','76550',
                          '79242','94464','29206','81560','67918',
                          '22542','62872','65898','79955','34929',
                          '67190','45369','68447','59372','73153',
                          '26454','96871','59288','35532','36001',
                          '66272','91285','54609','26523','11912',
                          '49682','57178','11756','28607','60306',
                          '60871','67480','44027','20160','29421',
                          '94183','22546','90765','26712','34661',
                          '45381','90734','36748','90840','73115',
                          '37339','32912','37968','94020','93374',
                          '21560','19287','88891','94369','61076',
                          '48717','38632','36571','64404','38970',
                          '56384','48661','60634','12115','63144',
                          '41825','93697','71054','88742','84445',
                          '19244','69872','62743','15794','24993',
                          '10153','20564','96204','82179','55697',
                          '55502','88284','46085','41806','69260',
                          '76759','39999','91063','13184','42482',
                          '61848','94698','65906','68583','48706',
                          '49187','37106','35443','81910','92314',
                          '97058','21670','94764','32290','38727',
                          '76254','70515','77316','49802','98430',
                          '23711','37850','70708','61007','13058',
                          '87027','35124','41153','40636','67665',
                          '46329','96047','17912','67500','97592',
                          '21280','62382','12078','60529','14309',
                          '43341','14414','99132','10995','60017',
                          '96792','36132','68102','78674','92994',
                          '45033','60682','25982','12472','83844',
                          '65701','29057','26656','94581','69077',
                          '95652','42936','69345','29267','16758',
                          '10396','82704','41615','79728','38198',
                          '81798','72466','42823','26966','88326',
                          '40940','40826','55134','56757','12826',
                          '47904','23965','55919','49332','92123',
                          '22135','51729','40186','84354','92578',
                          '94880','77998','90110','71384','82594',
                          '79746','25094','52442','21088','15660',
                          '80330','32233','23321','69743','15690',
                          '92039','15728','95220','26069','74302',
                          '23213','78618','61601','39261','60369',
                          '68746','37007','86362','77049','25530',
                          '59569','36102','42378','82825','38074',
                          '56591','88667','74736','90636','70368',
                          '68173','88348','75784','22614','78101',
                          '66412','32246','10450','51731','38998',
                          '87942','96815','76060','44850','89395',
                          '97930','10093','86296','77100','88118',
                          '95360','12003','21551','82723','24635',
                          '89577','71001','41963','58792','50129',
                          '90777','31500','89783','41351','60848',
                          '44622','23255','66210','30376','36140',
                          '75092','29264','55151','20880','46286',
                          '98392','32865','17356','22658','66554',
                          '56558','36699','74442','16698','61385',
                          '96129','17439','82597','83231','65645',
                          '82238','97089','53034','95292','12278',
                          '91538','55495','81965','55549','85615',
                          '68419','98067','14827','86536','76191',
                          '79817','41499','83033','45539','35001',
                          '92831','54424','51884','51513','92766',
                          '86098','35182','97172','96188','87937',
                          '10689','64767','22949','81257','24125',
                          '50303','44623','37543','71433','58007',
                          '37465','53613','65647','22483','36574',
                          '43298','64475','84763','89015','69508',
                          '36734','38754','25074','73161','96442',
                          '38271','42014','93282','36450','15329',
                          '72977','25536','56523','31573','28953',
                          '42144','27522','38848','74157','82501',
                          '40080','54772','40937','71198','49495',
                          '33755','96530','83384','55233','87696',
                          '63337','87561','67995','73964','29814',
                          '82056','58146','99194','60268','93639',
                          '15617','49945','46686','92155','21189',
                          '25753','30954','38853','78791','66299',
                          '62869','34098','84622','21549','36139',
                          '64101','49766','51169','39141','79645',
                          '85437','91205','52508','49059')
     intersect
      select ca_zip
      from (SELECT substr(ca_zip,1,5) ca_zip,count(*) cnt
            FROM customer_address, customer
            WHERE ca_address_sk = c_current_addr_sk and
                  c_preferred_cust_flag='Y'
            group by ca_zip
            having count(*) > 10)A1)A2) V1
 where ss_store_sk = s_store_sk
  and ss_sold_date_sk = d_date_sk
  and d_qoy = 1 and d_year = 2001
  and (substr(s_zip,1,2) = substr(V1.ca_zip,1,2))
 group by s_store_name
 order by s_store_name
 LIMIT 100;



select  s_store_name
      ,sum(ss_net_profit)
 from store_sales
     ,date_dim
     ,store,
     (select ca_zip
     from (
      SELECT substr(ca_zip,1,5) ca_zip
      FROM customer_address
      WHERE substr(ca_zip,1,5) IN (
                          '51060','70473','91072','22370','22893','11462',
                          '27141','39503','54625','31992','88466',
                          '36064','63980','86611','85614','92801',
                          '53334','18517','17480','98791','22072',
                          '57260','24554','36828','76944','52493',
                          '57611','74643','31178','16852','60196',
                          '34891','20518','73612','56123','59459',
                          '16675','29969','98335','24475','61425',
                          '66854','65612','41303','25400','72100',
                          '54677','68628','85123','13784','83347',
                          '40595','11119','88991','47028','39587',
                          '85975','61112','42606','86113','36231',
                          '52404','47606','49188','21105','72836',
                          '34286','43248','79137','30826','67308',
                          '65683','79362','66932','72186','35273',
                          '10899','87640','31576','22441','37296',
                          '84611','21325','39184','48784','65535',
                          '90156','93593','53477','64277','76532',
                          '68193','76551','75417','38031','26606',
                          '90611','11065','25398','74446','99962',
                          '30141','30945','55621','86302','24167',
                          '37453','92900','98464','29565','31593',
                          '57139','67433','98802','48423','86110',
                          '67466','49222','16234','43660','23751',
                          '57453','23962','90897','67171','46736',
                          '21855','44740','44948','87668','69445',
                          '34990','59250','83138','27664','26674',
                          '14392','56267','12611','39738','10563',
                          '39003','45196','74356','57401','11765',
                          '48197','17619','56851','87548','52975',
                          '15028','85685','35410','39773','43091',
                          '55433','60815','35330','96060','25379',
                          '90592','34213','24243','81636','27604',
                          '92170','50903','96167','65583','13570',
                          '30130','46954','81013','25377','53880',
                          '52378','30518','76840','56262','51996',
                          '76571','45431','45668','48952','25050',
                          '60975','16276','42015','97107','50769',
                          '91041','21588','67218','27910','92656',
                          '46474','86801','50272','45664','45081',
                          '67135','72737','64853','88079','60427',
                          '56474','52460','40393','53167','41489',
                          '73981','36962','12077','89433','71490',
                          '68796','71098','63758','21714','49801',
                          '38105','83764','86276','28519','39212',
                          '54714','52421','62323','72001','15805',
                          '42664','21485','87669','20167','41637',
                          '29036','52013','49065','24231','81890',
                          '54316','39334','40804','52812','82406',
                          '18675','11949','26428','39532','28918',
                          '67436','18097','49399','67523','22660',
                          '68964','22065','98307','43274','71347',
                          '17547','88677','48980','79653','58107',
                          '98225','39363','89169','36159','50073',
                          '19501','24801','52886','67739','13032',
                          '25632','15829','60704','17962','22669',
                          '89827','70697','21364','14547','58308',
                          '57582','83697','44089','85120','93830',
                          '70609','34115','48921','37590','94446',
                          '65973','43209','30158','23834','88125',
                          '38180','69208','70062','41437','83898',
                          '10101','60733','92625','83406','16681',
                          '37863','34426','44945','31838','94450',
                          '24713','17118','67652','17533','53089',
                          '92719','31493','74750','34749','26735',
                          '57422','78087','82563','80510','82603',
                          '78329','64501','93420','44112','11403',
                          '94184','92110','56280','68929','33851',
                          '85073','23332','59368','82838','38641',
                          '40959','47611','13641','72384','48757',
                          '27991','17784','39605','17387','68538',
                          '87439','59411','87853','12519','66224',
                          '91561','29465','21265','10730','34207',
                          '92474','43271','20145','73923','44145',
                          '77040','96427','61840','78928','45439',
                          '63065','27956','38015','37224','71587',
                          '85739','88383','70259','14686','40893',
                          '62884','26107','27328','78227','79328',
                          '65358','81159','26298','83641','18667',
                          '14454','77439','75454','82551')
     intersect
      select ca_zip
      from (SELECT substr(ca_zip,1,5) ca_zip,count(*) cnt
            FROM customer_address, customer
            WHERE ca_address_sk = c_current_addr_sk and
                  c_preferred_cust_flag='Y'
            group by ca_zip
            having count(*) > 10)A1)A2) V1
 where ss_store_sk = s_store_sk
  and ss_sold_date_sk = d_date_sk
  and d_qoy = 1 and d_year = 2000
  and (substr(s_zip,1,2) = substr(V1.ca_zip,1,2))
 group by s_store_name
 order by s_store_name
 LIMIT 100;



select  s_store_name
      ,sum(ss_net_profit)
 from store_sales
     ,date_dim
     ,store,
     (select ca_zip
     from (
      SELECT substr(ca_zip,1,5) ca_zip
      FROM customer_address
      WHERE substr(ca_zip,1,5) IN (
                          '26120','27788','52290','64147','11854','91618',
                          '72440','54883','39610','82272','38450',
                          '32483','27214','19693','98657','27213',
                          '93181','42178','64987','88375','80314',
                          '13680','51807','65258','79218','19809',
                          '16127','94708','93746','15243','37195',
                          '52013','57245','50412','16083','18376',
                          '84908','92072','59042','22066','61730',
                          '72094','68736','68057','24968','36228',
                          '58815','76252','90974','15011','49365',
                          '50410','18321','97561','71372','75759',
                          '47114','38210','50379','66420','94201',
                          '86362','24335','48143','20142','15849',
                          '48361','87967','20461','22249','49623',
                          '42440','95712','26995','89839','52451',
                          '43035','71510','37170','61337','69844',
                          '52097','31356','94604','46839','13818',
                          '47768','89178','21074','92264','72905',
                          '21785','85770','34116','55628','80779',
                          '42531','11417','64753','78257','92112',
                          '67876','51672','38197','21611','47416',
                          '65213','45634','95622','10668','66166',
                          '28552','63284','61182','34313','62724',
                          '50369','26317','76692','51462','28799',
                          '41415','47769','88077','18565','40085',
                          '56505','44388','54649','37924','83238',
                          '92711','99245','99076','17827','56671',
                          '99739','93462','33833','30127','27549',
                          '64484','73005','16380','11910','53511',
                          '55356','56989','72002','88687','29137',
                          '97453','62103','42377','64892','27886',
                          '36942','12085','48004','83870','15744',
                          '42662','30681','94115','31635','95527',
                          '43663','65832','12553','41763','76525',
                          '67379','77182','71256','69891','72578',
                          '89671','26933','30051','23115','66682',
                          '80044','40912','88918','27248','39670',
                          '92633','89557','40902','57408','98183',
                          '57369','53870','40771','14126','26840',
                          '11286','63288','65494','49993','66513',
                          '24822','55815','99405','92511','45831',
                          '84433','75485','97462','72160','51084',
                          '95564','28779','98897','15774','50592',
                          '79427','25795','99277','36178','50957',
                          '15747','74208','79523','50538','30906',
                          '26610','19308','17601','65204','27015',
                          '65442','43241','58096','72581','86958',
                          '95348','36469','68554','41193','25604',
                          '77976','98851','26725','91729','95248',
                          '53395','20282','28542','68087','18646',
                          '63082','30809','30364','25074','88313',
                          '72972','56138','23823','64096','42194',
                          '92223','81432','65713','68873','58592',
                          '52151','32664','56059','55218','99766',
                          '55600','18427','47298','88765','84229',
                          '53957','49111','64609','39683','99481',
                          '54736','44845','90521','44746','31426',
                          '24779','68794','80762','71969','59061',
                          '96147','10310','37682','53907','37407',
                          '22648','47801','35402','19178','95824',
                          '57692','96839','21532','98331','86857',
                          '98051','63122','46332','61345','90336',
                          '34976','25030','29808','53962','88706',
                          '95088','26437','19600','80278','94886',
                          '76375','16888','22464','77359','66353',
                          '75771','85702','69805','18900','67398',
                          '42067','84154','86843','47547','19152',
                          '28612','19866','35828','24899','86394',
                          '87814','65601','69255','68315','62639',
                          '37453','11784','68808','75542','57570',
                          '62337','82796','85647','26240','34533',
                          '13981','13297','52113','78082','41483',
                          '41245','80901','55876','58508','96816',
                          '61971','44529','48658','18008','56794',
                          '34515','80487','71163','22357','47010',
                          '74689','96002','94674','26334','81033',
                          '51177','61265','49899','60427','22499',
                          '78748','14059','51058','68034','64002',
                          '58237','51044','82220','10084','57291',
                          '23783','78084','73015','59748')
     intersect
      select ca_zip
      from (SELECT substr(ca_zip,1,5) ca_zip,count(*) cnt
            FROM customer_address, customer
            WHERE ca_address_sk = c_current_addr_sk and
                  c_preferred_cust_flag='Y'
            group by ca_zip
            having count(*) > 10)A1)A2) V1
 where ss_store_sk = s_store_sk
  and ss_sold_date_sk = d_date_sk
  and d_qoy = 1 and d_year = 2002
  and (substr(s_zip,1,2) = substr(V1.ca_zip,1,2))
 group by s_store_name
 order by s_store_name
 LIMIT 100;



select  s_store_name
      ,sum(ss_net_profit)
 from store_sales
     ,date_dim
     ,store,
     (select ca_zip
     from (
      SELECT substr(ca_zip,1,5) ca_zip
      FROM customer_address
      WHERE substr(ca_zip,1,5) IN (
                          '59785','40369','32519','89386','36723','51899',
                          '44868','48181','91836','90129','94469',
                          '84983','46784','39657','15224','50329',
                          '10327','49157','68264','45559','78433',
                          '77469','56133','79355','73155','22765',
                          '16839','47043','18952','98257','48867',
                          '34019','62269','16147','48960','69707',
                          '87766','54905','11623','33875','37620',
                          '17954','22959','57842','67270','26001',
                          '56172','81860','87998','15725','92375',
                          '68734','40258','40169','33151','76912',
                          '33408','27651','74764','58808','18460',
                          '52787','25094','67533','94605','52986',
                          '48642','64321','90997','13201','30387',
                          '64432','77041','15353','99585','83319',
                          '79229','73170','96951','75877','20890',
                          '69912','11411','69533','42938','27214',
                          '60731','25753','54671','10478','86987',
                          '50571','45393','46158','14071','15260',
                          '65889','88134','51270','20619','21915',
                          '10608','30080','55580','36378','99593',
                          '58494','27157','36421','12000','71863',
                          '46994','42387','52535','62390','54954',
                          '12660','70510','88513','69558','79639',
                          '73281','85902','64779','74364','68249',
                          '46730','27203','58837','15391','92225',
                          '62920','24549','38133','57501','27851',
                          '57211','15610','90382','90748','12855',
                          '51844','45752','41215','93739','31903',
                          '75603','33683','21419','89805','45535',
                          '58566','18134','75173','54508','51954',
                          '24691','68379','81303','42953','64167',
                          '62675','82560','90232','22828','34673',
                          '14585','20380','59892','68653','30130',
                          '32422','18813','95065','73924','81495',
                          '13204','79223','56345','92099','61519',
                          '50837','97979','92601','80036','64064',
                          '75054','24964','38745','71171','19844',
                          '34206','21552','25349','39953','46614',
                          '39074','47431','92805','39514','55413',
                          '57841','18343','87217','12044','62192',
                          '15397','16734','21985','18236','37683',
                          '54870','39212','74501','47937','21620',
                          '90057','88236','46789','85051','53401',
                          '17670','99999','96924','91634','40004',
                          '65380','12881','72392','19977','60554',
                          '17982','81354','97477','97962','57511',
                          '64084','95427','67744','29096','71194',
                          '81399','62042','91967','15388','76870',
                          '14833','80829','57950','60104','34467',
                          '73447','44439','87534','77826','55882',
                          '61741','49730','64534','95222','48371',
                          '78107','28398','89842','29332','88330',
                          '48933','72249','61769','32819','37462',
                          '44236','18692','93492','55492','21930',
                          '35680','77317','61356','94692','73567',
                          '97539','22612','31054','70760','18878',
                          '23318','12587','35071','82637','11811',
                          '69364','34776','52505','37100','34017',
                          '96187','63337','64068','74551','90247',
                          '83848','21070','19108','56646','69278',
                          '84120','24847','72247','56669','20033',
                          '99211','71851','50493','67375','67445',
                          '35863','98334','51389','67655','71897',
                          '57710','35076','41618','99805','23956',
                          '51636','24447','41185','82378','14035',
                          '90388','18342','58989','77558','41975',
                          '66249','79211','67014','44168','84740',
                          '31022','40936','66928','70439','25383',
                          '22855','44891','79837','57930','81686',
                          '40254','16062','75646','16741','67536',
                          '83087','13924','50412','28030','25514',
                          '10374','68548','17129','60531','76737',
                          '88042','55806','91458','70270','42711',
                          '45580','86982','51436','90402','85529',
                          '94217','59756','48345','79468','66264',
                          '12217','10612','93859','40866','70349',
                          '79803','63331','84830','77569','60968',
                          '45974','47048','91540','55656','64400',
                          '34596','90532','56718','70770')
     intersect
      select ca_zip
      from (SELECT substr(ca_zip,1,5) ca_zip,count(*) cnt
            FROM customer_address, customer
            WHERE ca_address_sk = c_current_addr_sk and
                  c_preferred_cust_flag='Y'
            group by ca_zip
            having count(*) > 10)A1)A2) V1
 where ss_store_sk = s_store_sk
  and ss_sold_date_sk = d_date_sk
  and d_qoy = 1 and d_year = 2002
  and (substr(s_zip,1,2) = substr(V1.ca_zip,1,2))
 group by s_store_name
 order by s_store_name
 LIMIT 100;



select  s_store_name
      ,sum(ss_net_profit)
 from store_sales
     ,date_dim
     ,store,
     (select ca_zip
     from (
      SELECT substr(ca_zip,1,5) ca_zip
      FROM customer_address
      WHERE substr(ca_zip,1,5) IN (
                          '90416','12607','26205','33463','71017','32037',
                          '22779','72740','50849','69022','81823',
                          '19417','17686','58257','26649','12779',
                          '47510','86191','83841','64910','92272',
                          '72534','55340','54616','28050','90309',
                          '16061','54425','90662','97215','44744',
                          '70196','99597','49008','26651','64981',
                          '21204','72244','97360','74355','95657',
                          '65627','30732','72724','14712','83384',
                          '76346','31925','95510','83262','78612',
                          '35805','69164','19758','44090','70023',
                          '57470','61182','94434','99200','58677',
                          '51203','30881','32514','10393','19321',
                          '82033','90079','70536','32961','64510',
                          '53629','52092','29918','57268','35422',
                          '93048','37601','20198','41144','25520',
                          '27343','48101','17331','69581','45929',
                          '60679','71747','91484','63708','14566',
                          '93466','28330','81535','88956','87881',
                          '11895','50481','29120','54952','42082',
                          '91946','28753','51110','86461','23526',
                          '79042','33994','39576','16558','54996',
                          '41872','96238','30342','17239','24909',
                          '16068','15708','82829','76114','70515',
                          '57215','93293','20976','83555','63923',
                          '89810','80387','96376','95022','13704',
                          '77142','27081','12767','90565','78503',
                          '75263','53212','25121','57778','31275',
                          '64793','95509','88593','40117','77634',
                          '44218','73877','54652','24318','27285',
                          '88796','38098','28731','86149','18230',
                          '96242','96543','95511','42664','48339',
                          '43864','99519','30656','83738','54800',
                          '70869','37250','58115','41042','46074',
                          '47741','30007','27043','30918','59907',
                          '41981','97874','41994','84894','53727',
                          '55747','40972','59698','56478','86562',
                          '74955','56590','79544','96772','76765',
                          '34821','50313','22808','50823','23664',
                          '78231','58666','31899','64251','92147',
                          '45688','27280','36091','29019','53392',
                          '78105','40669','56896','36488','54879',
                          '19656','70572','14654','37441','21758',
                          '86470','82299','80867','35607','98391',
                          '18275','24869','23984','54923','24678',
                          '52791','78208','28811','36052','32013',
                          '92320','28150','24762','29043','78124',
                          '35771','28812','89887','74025','63200',
                          '89503','60686','89943','25789','10728',
                          '47178','38908','31713','17939','75916',
                          '67747','57885','65012','50079','43930',
                          '63410','42568','71326','29999','78963',
                          '89033','49344','76102','71795','96166',
                          '17746','21057','41970','60853','43401',
                          '31877','29007','11789','47559','63464',
                          '73019','13927','29410','93275','88892',
                          '37240','11955','67176','40394','24903',
                          '84593','93218','15030','10158','14526',
                          '13722','79284','62377','69634','58465',
                          '30538','10620','65001','31076','97961',
                          '87292','38526','53533','40904','42257',
                          '96990','64427','38657','74178','86919',
                          '41668','34248','44128','44020','65410',
                          '25341','47690','21233','12400','96863',
                          '85684','29224','99138','88821','69251',
                          '29603','90453','86008','99546','74038',
                          '71048','17282','98994','87778','19451',
                          '93923','38274','31632','76243','78201',
                          '18053','44868','79856','83035','90332',
                          '33607','18922','87993','27557','29541',
                          '96135','21726','50036','83213','84758',
                          '88420','35283','55069','11592','92468',
                          '89256','66317','71537','76268','18089',
                          '36388','65204','84256','43637','31249',
                          '21686','25251','79635','36825','63181',
                          '11253','48955','80250','33299','80641',
                          '88275','33465','61537','96005','89018',
                          '38684','26345','15942','13357','45946',
                          '78729','60985','63054','86661','64026',
                          '54443','52970','36794','71836')
     intersect
      select ca_zip
      from (SELECT substr(ca_zip,1,5) ca_zip,count(*) cnt
            FROM customer_address, customer
            WHERE ca_address_sk = c_current_addr_sk and
                  c_preferred_cust_flag='Y'
            group by ca_zip
            having count(*) > 10)A1)A2) V1
 where ss_store_sk = s_store_sk
  and ss_sold_date_sk = d_date_sk
  and d_qoy = 1 and d_year = 2001
  and (substr(s_zip,1,2) = substr(V1.ca_zip,1,2))
 group by s_store_name
 order by s_store_name
 LIMIT 100;



select  s_store_name
      ,sum(ss_net_profit)
 from store_sales
     ,date_dim
     ,store,
     (select ca_zip
     from (
      SELECT substr(ca_zip,1,5) ca_zip
      FROM customer_address
      WHERE substr(ca_zip,1,5) IN (
                          '12113','17701','65154','14167','54781','29983',
                          '50464','90212','97047','68318','68009',
                          '22298','43504','62504','19332','33577',
                          '16181','35860','57147','82213','83178',
                          '69299','90535','79752','39750','89359',
                          '26119','99487','23989','45520','80317',
                          '88670','70172','38877','50539','97337',
                          '63559','88459','32931','85098','22982',
                          '96419','65071','30856','50935','27877',
                          '25669','53317','43917','22043','24199',
                          '37338','57973','35433','30336','86072',
                          '28119','18756','74492','16881','60516',
                          '12221','67943','85614','63045','58107',
                          '63752','75967','79649','19602','29703',
                          '82450','45489','13351','53609','23565',
                          '61813','98152','77746','58510','77504',
                          '11182','26478','77696','58970','91726',
                          '85745','71998','23447','52879','22831',
                          '89926','21041','65239','62884','95543',
                          '12844','47478','29547','84182','83526',
                          '95771','31807','72934','65137','16187',
                          '46769','61634','78592','53685','47445',
                          '50367','34129','95318','94735','30492',
                          '22862','83586','11250','78581','48939',
                          '64906','87459','47059','12146','87917',
                          '53863','93092','21586','54461','63171',
                          '68459','18554','53333','95358','27610',
                          '95275','64952','73309','26718','41340',
                          '45770','44321','35110','31845','27643',
                          '80067','63852','53753','86368','49701',
                          '11805','74159','34590','54040','32593',
                          '38077','49564','64601','40575','65797',
                          '73687','63736','38731','24593','49405',
                          '64176','43849','97828','58556','62615',
                          '13916','94543','80480','31042','25150',
                          '56661','96602','41430','92648','69024',
                          '44949','75128','70603','43152','10623',
                          '66302','55242','31489','32178','62049',
                          '79224','37851','16243','30444','19961',
                          '22381','38015','97400','26054','76117',
                          '24226','28199','72699','96063','47991',
                          '13196','71558','81338','66197','65421',
                          '16782','70921','35224','12081','40246',
                          '21855','53431','22469','43682','76377',
                          '68709','20182','45696','39866','78533',
                          '83483','53877','37556','36489','85857',
                          '62119','43588','40685','10494','85197',
                          '80985','40656','78389','76120','58414',
                          '74439','51112','64702','28624','29258',
                          '23957','92437','53911','89776','51579',
                          '38081','39779','46866','29461','61945',
                          '87011','59748','62199','34835','56442',
                          '76620','40986','11161','98087','61814',
                          '56450','67259','78355','33695','80765',
                          '79083','19870','72399','96840','64637',
                          '19894','57826','81280','19576','80270',
                          '69276','50248','36828','68182','44083',
                          '61032','22291','34466','90912','83714',
                          '12061','47378','88762','56266','93886',
                          '70276','90041','34435','42110','83341',
                          '47037','46188','53226','74141','73633',
                          '76716','90624','88266','79154','57793',
                          '30957','25846','48498','82696','53336',
                          '52328','84924','45344','42132','79568',
                          '91033','58598','24433','85008','15900',
                          '15789','18129','16421','33357','37408',
                          '18598','78981','26562','44087','31195',
                          '11530','79452','72893','99979','55443',
                          '99554','54024','73839','59413','36423',
                          '81123','27228','96284','94249','76361',
                          '87684','12708','35091','36119','91991',
                          '26547','10945','35083','80896','48306',
                          '54118','26679','73753','78611','87435',
                          '95035','38062','69640','14736','47425',
                          '44798','21191','49429','59317','80268',
                          '39629','13302','53577','93526','14188',
                          '79318','87099','16096','63411','40197',
                          '43967','66224','64187','71428','69762',
                          '89042','25925','70591','34406','41353',
                          '48584','21627','96837','37298')
     intersect
      select ca_zip
      from (SELECT substr(ca_zip,1,5) ca_zip,count(*) cnt
            FROM customer_address, customer
            WHERE ca_address_sk = c_current_addr_sk and
                  c_preferred_cust_flag='Y'
            group by ca_zip
            having count(*) > 10)A1)A2) V1
 where ss_store_sk = s_store_sk
  and ss_sold_date_sk = d_date_sk
  and d_qoy = 2 and d_year = 1999
  and (substr(s_zip,1,2) = substr(V1.ca_zip,1,2))
 group by s_store_name
 order by s_store_name
 LIMIT 100;



select  s_store_name
      ,sum(ss_net_profit)
 from store_sales
     ,date_dim
     ,store,
     (select ca_zip
     from (
      SELECT substr(ca_zip,1,5) ca_zip
      FROM customer_address
      WHERE substr(ca_zip,1,5) IN (
                          '25479','79060','13026','50279','38614','50838',
                          '79964','95215','68493','33514','69736',
                          '48619','80133','31715','84869','94667',
                          '36231','43751','35350','72858','39889',
                          '39346','51877','72512','24136','12725',
                          '75530','43725','72074','80660','56836',
                          '18466','23567','37130','65984','68527',
                          '47866','12975','98294','73740','65123',
                          '47757','56242','53214','11334','37980',
                          '20682','67607','67446','24939','29368',
                          '79937','62479','25783','97415','68000',
                          '85746','38348','27974','25520','36219',
                          '44374','99775','54030','53369','28750',
                          '40491','94962','60014','96942','59093',
                          '13058','36919','21810','39073','53319',
                          '63857','43347','71500','40628','47667',
                          '47719','73498','22324','21680','20884',
                          '76084','77510','88526','42925','53781',
                          '98899','26154','20275','97999','95573',
                          '21390','46813','14458','18819','46488',
                          '20839','89886','74133','79815','58082',
                          '19937','31149','42065','49750','23871',
                          '90885','52818','94303','40018','14086',
                          '78088','59144','74044','22143','24235',
                          '15555','80384','68525','73708','23948',
                          '31292','79951','13970','30218','28912',
                          '17204','98174','45308','46714','62847',
                          '11561','58493','80584','45700','33046',
                          '72535','80926','90467','87810','15559',
                          '45046','63065','83826','76315','18156',
                          '72311','85223','84455','69664','71840',
                          '65559','38133','33936','14433','91997',
                          '80845','80397','29399','34042','86092',
                          '87198','68866','97576','79604','78228',
                          '87129','51895','30474','67405','65036',
                          '85363','37451','63597','41721','79484',
                          '11348','98059','63584','77567','53585',
                          '38257','77840','35895','27744','52110',
                          '25321','81807','52983','46079','18528',
                          '83027','20965','15224','54341','20037',
                          '34214','54963','52413','15078','40590',
                          '41788','63439','77605','76180','55901',
                          '89320','35255','93644','18120','33372',
                          '84881','77300','66680','29923','17815',
                          '43507','85051','43396','19381','98129',
                          '20466','91965','95045','65165','33611',
                          '75526','62621','37733','25424','53653',
                          '75709','63453','25719','39276','90430',
                          '48098','21864','41368','52185','94974',
                          '65046','93764','46750','72470','68379',
                          '96737','29422','12835','11628','15682',
                          '19948','83917','23430','74368','53545',
                          '82975','18570','39013','96076','43880',
                          '66360','63182','32848','27586','17814',
                          '84286','44491','22126','48953','45844',
                          '84936','68095','81314','62455','42900',
                          '95420','83040','87736','44011','48880',
                          '92537','15328','53804','64356','52240',
                          '79463','64811','85452','96404','92042',
                          '74037','27349','27525','66618','24076',
                          '79956','53410','71778','73968','12793',
                          '68781','34170','63296','78471','92012',
                          '22051','41044','50915','48547','73238',
                          '23246','15757','96165','88930','98351',
                          '93512','51898','29926','16301','41254',
                          '25995','15947','12110','57044','13069',
                          '72822','31045','69853','20861','31807',
                          '92888','68857','77770','83608','75083',
                          '16978','75393','15083','88191','64292',
                          '12572','46216','17602','79092','74340',
                          '18023','88527','42500','10583','55006',
                          '39323','12313','37361','38944','37691',
                          '54929','55918','42299','12873','58433',
                          '88665','20191','77392','92017','27124',
                          '51461','40668','27509','68052','98530',
                          '49259','15483','62096','93205','12354',
                          '89032','78477','66512','20292','23313',
                          '73429','92620','84654','91264','32764',
                          '95645','80798','51135','81499','68163',
                          '85703','13338','46722','60495')
     intersect
      select ca_zip
      from (SELECT substr(ca_zip,1,5) ca_zip,count(*) cnt
            FROM customer_address, customer
            WHERE ca_address_sk = c_current_addr_sk and
                  c_preferred_cust_flag='Y'
            group by ca_zip
            having count(*) > 10)A1)A2) V1
 where ss_store_sk = s_store_sk
  and ss_sold_date_sk = d_date_sk
  and d_qoy = 1 and d_year = 2000
  and (substr(s_zip,1,2) = substr(V1.ca_zip,1,2))
 group by s_store_name
 order by s_store_name
 LIMIT 100;


